<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grabadora de Audio</title>
<script src="https://cdn.jsdelivr.net/npm/mp3-converter.js"></script>
</head>
<body>
<h1>Grabadora de Audio</h1>
<button id="startRecording">Comenzar Grabación</button>
<button id="stopRecording" disabled>Detener Grabación</button>
<a id="downloadLink" download="grabacion.mp3" style="display: none;">Descargar Grabación</a>

<script>
let mediaRecorder;
let chunks = [];

const startRecording = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);

  mediaRecorder.ondataavailable = (e) => {
    chunks.push(e.data);
  };

  mediaRecorder.onstop = () => {
    const blob = new Blob(chunks, { type: 'audio/wav' });
    const audioURL = URL.createObjectURL(blob);
    const downloadLink = document.getElementById('downloadLink');
    downloadLink.href = audioURL;
    downloadLink.style.display = 'block';
    downloadLink.onclick = () => {
      const convertedAudioBlob = Mp3Converter.convert(blob);
      const convertedAudioURL = URL.createObjectURL(convertedAudioBlob);
      const a = document.createElement('a');
      a.style.display = 'none';
      a.href = convertedAudioURL;
      a.download = 'grabacion.mp3';
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(convertedAudioURL);
    };
  };

  mediaRecorder.start();
  document.getElementById('startRecording').disabled = true;
  document.getElementById('stopRecording').disabled = false;
};

const stopRecording = () => {
  mediaRecorder.stop();
  document.getElementById('startRecording').disabled = false;
  document.getElementById('stopRecording').disabled = true;
};

document.getElementById('startRecording').addEventListener('click', startRecording);
document.getElementById('stopRecording').addEventListener('click', stopRecording);
</script>
</body>
</html>
